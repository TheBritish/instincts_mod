# Add our custom on_actions to the yearly pulse (fires once per year)
yearly_country_pulse = {
	on_actions = {
		hanseatic_league_event_dispatcher
		hanseatic_league_invite_dispatcher
		general_random_event_dispatcher
	}
}

# Debug: ensure the IO exists on game start for testing
on_game_start = {
	on_actions = {
		instincts_hl_create_io
	}
}

instincts_hl_create_io = {
	# Only create if the IO doesn't already exist
	trigger = {
		NOT = { any_international_organization = { limit = { type = international_organization_type:hanseatic_league } } }
	}

	effect = {
		create_international_organization = {
			type = hanseatic_league
			creator = HSA
			save_scope_as = target_io
		}

		scope:target_io = {
			add_country_to_international_organization = HSA
			add_country_to_international_organization = LUB
			add_country_to_international_organization = HAM
			add_country_to_international_organization = BRM
			set_leader_country = HSA
		}
	}
}

# Hanseatic League events - only for IO members
hanseatic_league_event_dispatcher = {
	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
	}
	
	random_events = {
		10 = hanseatic_league_events.1
		10 = hanseatic_league_events.2
		10 = hanseatic_league_events.3
		10 = hanseatic_league_events.4
		10 = hanseatic_league_events.5
		10 = hanseatic_league_events.6
		10 = hanseatic_league_events.7
		10 = hanseatic_league_events.8
		10 = hanseatic_league_events.9
		10 = hanseatic_league_events.10
		10 = hanseatic_league_events.11
		10 = hanseatic_league_events.12
		10 = hanseatic_league_events.13
		10 = hanseatic_league_events.14
		10 = hanseatic_league_events.15
		10 = hanseatic_league_events.16
		10 = hanseatic_league_events.17
		10 = hanseatic_league_events.18
		10 = hanseatic_league_events.19
		10 = hanseatic_league_events.20
	}
}

# General random events - for all countries
general_random_event_dispatcher = {
	random_events = {
		5 = random_event.1001  # Lucky donation event (rare)
	}
}

# Invite dispatcher: leader countries may propose adding a candidate once per year
hanseatic_league_invite_dispatcher = {
	trigger = {
		is_leader_of_international_organization = international_organization:hanseatic_league
	}

	effect = {
		# find a candidate country: single-location, coastal, not already member
		any_country = {
			limit = {
				num_locations = 1
				any_owned_location = { is_coastal = yes }
				NOT = { is_member_of_international_organization = international_organization:hanseatic_league }
				country_can_join_international_organization = international_organization:hanseatic_league
			}
			# save candidate and fire a country event targeted at them from the leader
			save_scope_as = invite_candidate
			root = { trigger_event = { id = hanseatic_league_events.1000 days = 0 target = scope:invite_candidate } }
		}
	}
}
