# Hanseatic Trade Network - represents the economic/cultural union
# Works alongside HSA vassal overlord system in vanilla
# Enhanced with valid EU5 modifiers from official wiki
hanseatic_league = {
	has_target = no
	unique = yes
	expel_members_who_are_targets_of_other_members = no

	show_as_overlord_on_map_trigger = {
		always = yes
	}

	has_leader_country = yes
	leader_title_key = "HANSEATIC_LEAGUE_LEADER"
	leader_type = country
	leader_change_trigger_type = none
	leader_change_method = none
	disband_if_no_leader = no

	leader = {
		leader_country ?= {
			add_to_list = leaders
		}
	}

	create_visible_trigger = {
		always = no
	}

	invite_visible_trigger = {
		always = yes
	}

	can_initiate_policy_votes = {
		is_leader_of_international_organization = scope:recipient
	}

	can_declare_war = {
		always = yes
	}

	gives_military_access_to_all_when_at_war = yes
	
	# Hanseatic cities generally respected each other's trading privileges
	antagonism_modifier_for_taking_land_from_fellow_member = 1.0
	antagonism_modifier_for_taking_land_from_member_as_outsider = 1.0
	no_cb_price_modifier_for_fellow_member = 0.75	# Land ownership rules for IO-controlled territories
	land_ownership_rule = hanseatic_league_land_ownership
	
	# Base benefits for all members: trade network, merchant cooperation, naval coordination
	modifier = {
		trade_efficiency = 0.05
		global_merchant_capacity_modifier = 0.05
		global_fish_output_modifier = 0.05
		global_salt_output_modifier = 0.05
		tolerance_heretic = 1
		diplomatic_capacity = 1
		global_naval_forcelimit_modifier = 0.1
	}
	
	# Leaders (HSA) get additional benefits for coordinating the league
	leader_modifier = {
		diplomatic_capacity = 2
		global_merchant_capacity_modifier = 0.10
		global_burghers_desired_pop = 0.05
		monthly_prestige = 0.5
		trade_efficiency = 0.10
	}
	
        can_join_trigger = {
                # Founding members can always join
                trigger_if = {
                        limit = {
                                tag = HSA
                        }
                        always = yes
                }
                # Allow HRE members to join with specific requirements
                trigger_if = {
                        limit = {
                                is_member_of_international_organization = international_organization:hre
                        }
                        # HRE members must be single-location coastal countries
                        num_of_locations = 1
                        any_location = {
                                coastal = yes
                        }
                }
                trigger_if = {
                        limit = {
                                NOT = {
                                        is_member_of_international_organization = international_organization:hre
                                }
                        }
                        # Countries not in HRE must meet strict requirements
                        num_of_locations = 1
                        any_location = {
                                coastal = yes
                        }
                }
        }
	can_lead_trigger = {
		# Allow founding members to lead the Hanseatic League
		OR = {
			tag = HSA  # Lübeck - traditional leader
			tag = LUB  # Lübeck area
			tag = HAM  # Hamburg
			tag = BRM  # Bremen
		}
	}
	
	can_leave_trigger = {
		always = yes
	}
	
	auto_leave_trigger = {
		# Hanseatic League members stay even as vassals
		# (historical Hanseatic merchants maintained trading privileges as subjects)
		always = no
	}

	auto_disband_trigger = {
		total_members < 3
	}

	on_joined = {
		custom_tooltip = "HANSEATIC_LEAGUE_JOINED_TT"
	}

	on_left = {
		custom_tooltip = "HANSEATIC_LEAGUE_LEFT_TT"
	}

	# AI desire weights for joining the Hanseatic League
	ai_desire_to_join = {
		# Base desire for all candidates
		add = { value = 5 }

		# Strong boost for founding city (always wants to be member)
		trigger_if = {
			limit = { tag = HSA }
			add = { value = 100 }
		}

		# Single-location coastal countries get a large bonus
		trigger_if = {
			limit = {
				num_of_locations = 1
				any_location = { coastal = yes }
			}
			add = { value = 40 }
		}

		# Cultural affinity: Germanic culture increases desire
		trigger_if = {
			limit = { culture_group = culture_group:germanic }
			add = { value = 15 }
		}

		# Economic incentive: higher trade efficiency makes joining attractive
		# This is a rough proxy using merchant_capacity; scale value accordingly
		add = {
			value = 0
			if = {
				limit = { merchant_capacity > 0 }
				# Use a small multiplier of merchant_capacity to influence desire
				value = "(merchant_capacity * 5)"
			}
		}

		# Proximity: any owned location in core Hansa areas increases desire
		add = {
			value = 0
			if = {
				limit = {
					any_owned_location = { area = lower_saxony_area }
				}
				value = 10
			}
		}

		# Leader preference: if actor is near leader or has good opinion of leader
		add = {
			value = 0
			if = {
				limit = {
					scope:recipient.leader_country = { exists = yes }
				}
				# small bonus if opinion of leader > 0
				if = {
					limit = { opinion = { target = scope:recipient.leader_country value > 0 } }
					value = 8
				}
			}
		}

		# Penalty for being already member of an exclusive IO, small negative value
		trigger_if = {
			limit = { is_member_of_international_organization = international_organization:hre }
			add = { value = -5 }
		}
	}

	# AI desire to allow new members (existing members' willingness to accept candidates)
	ai_desire_to_allow_new_member = {
		# Base conservatism: members slightly resist new add-ons by default
		add = { value = -5 }

		# Leaders prefer expanding the league moderately
		trigger_if = {
			limit = { is_leader_of_international_organization = yes }
			add = { value = 20 }
		}

		# Members with high trade efficiency prefer more members (network benefits)
		add = {
			value = 0
			if = {
				limit = { trade_efficiency > 0 }
				# scale slightly by trade_efficiency
				value = "(trade_efficiency * 10)"
			}
		}

		# Cultural affinity: members more open if candidate shares culture group
		add = {
			value = 0
			if = {
				limit = { culture_group = culture_group:germanic }
				value = 10
			}
		}

		# Strategic proximity: members with owned locations in target areas support adding nearby members
		add = {
			value = 0
			if = {
				limit = { any_owned_location = { area = lower_saxony_area } }
				value = 8
			}
		}

		# Penalty if candidate is large continental power (not desirable)
		trigger_if = {
			limit = { num_of_locations > 5 }
			add = { value = -20 }
		}
	}

	# AI desire for members (existing organization agents considering adding a candidate)
	ai_desire_to_add_member = {
		# Neutral baseline -- leader can push more strongly
		add = { value = 0 }

		# Leaders actively propose growth when they control the IO
		trigger_if = {
			limit = { is_leader_of_international_organization = yes }
			add = { value = 30 }
		}

		# Founding/strong Hansa cities push to expand network
		trigger_if = {
			limit = { tag = HSA }
			add = { value = 25 }
		}

		# Candidate attributes - single-location coastal candidates are attractive
		trigger_if = {
			limit = {
				num_of_locations = 1
				any_location = { coastal = yes }
			}
			add = { value = 25 }
		}

		# Trade incentive: members with merchant capacity support adding trade partners
		add = {
			value = 0
			if = {
				limit = { merchant_capacity > 0 }
				value = "(merchant_capacity * 4)"
			}
		}

		# Cultural affinity bonus for Germanic culture group
		trigger_if = {
			limit = { culture_group = culture_group:germanic }
			add = { value = 10 }
		}

		# Proximity helps: members with holdings in Hansa areas support adding nearby
		add = {
			value = 0
			if = {
				limit = { any_owned_location = { area = lower_saxony_area } }
				value = 10
			}
		}

		# Penalize adding large continental powers or existing subjects
		trigger_if = {
			limit = { num_of_locations > 5 }
			add = { value = -30 }
		}

		trigger_if = {
			limit = { is_subject = yes }
			add = { value = -15 }
		}
	}
}

