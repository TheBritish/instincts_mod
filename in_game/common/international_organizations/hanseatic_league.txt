# Hanseatic Trade Network - represents the economic/cultural union
# Works alongside HSA vassal overlord system in vanilla
# Enhanced with valid EU5 modifiers from official wiki
hanseatic_league = {
	has_target = no
	unique = yes
	expel_members_who_are_targets_of_other_members = no

	has_leader_country = yes
	leader_title_key = "HANSEATIC_LEAGUE_LEADER"
	leader_type = country
	disband_if_no_leader = no

	leader = {
		leader_country ?= {
			add_to_list = leaders
		}
	}

	# Make the IO visible on the diplomatic map/UI
	show_on_diplomatic_map = yes

	create_visible_trigger = {
		always = yes
	}

	invite_visible_trigger = {
		is_leader_of_international_organization = international_organization:hanseatic_league
	}

	can_initiate_policy_votes = {
		is_leader_of_international_organization = international_organization:hanseatic_league
	}

	can_declare_war = {
		always = yes
	}

	gives_military_access_to_all_when_at_war = yes

	# Hanseatic cities generally respected each other's trading privileges
	antagonism_modifier_for_taking_land_from_fellow_member = 1.0
	antagonism_modifier_for_taking_land_from_member_as_outsider = 1.0
	no_cb_price_modifier_for_fellow_member = 0.75	# Land ownership rules for IO-controlled territories
	land_ownership_rule = hanseatic_league_land_ownership

	# Base benefits for all members: trade network, merchant cooperation, naval coordination
	modifier = {
		trade_efficiency = 0.05
		global_merchant_capacity_modifier = 0.05
		global_fish_output_modifier = 0.05
		global_salt_output_modifier = 0.05
		tolerance_heretic = 1
		diplomatic_capacity = 1
		naval_forcelimit = 0.10
	}

	# Leaders (HSA) get additional benefits for coordinating the league
	leader_modifier = {
		diplomatic_capacity = 2
		global_merchant_capacity_modifier = 0.10
		global_burghers_desired_pop = 0.05
		monthly_prestige = 0.5
		trade_efficiency = 0.10
	}

	can_join_trigger = {
		OR = {
			# Founding HSA tag automatically allowed
			tag = HSA

			# Single-location coastal countries (good candidates)
			AND = {
				num_locations = 1
				any_owned_location = { is_coastal = yes }
			}

			# Members of the HRE that meet the same single-location coastal requirement
			AND = {
				is_member_of_international_organization = international_organization:hre
				num_locations = 1
				any_owned_location = { is_coastal = yes }
			}
		}
	}

	can_lead_trigger = {
		# Allow founding members to lead the Hanseatic League
		OR = {
			tag = HSA  # Lübeck - traditional leader
			tag = LUB  # Lübeck area
			tag = HAM  # Hamburg
			tag = BRM  # Bremen
		}
	}

	can_leave_trigger = { always = yes }

	auto_leave_trigger = {
		# Hanseatic League members stay even as vassals
		# (historical Hanseatic merchants maintained trading privileges as subjects)
		always = no
	}

	auto_disband_trigger = { total_members < 3 }

	on_joined = {
		custom_tooltip = "HANSEATIC_LEAGUE_JOINED_TT"
		add_country_modifier = { modifier = hanseatic_new_member years = 1 }
	}

	on_left = { custom_tooltip = "HANSEATIC_LEAGUE_LEFT_TT" }

	# AI desire weights for joining the Hanseatic League
	ai_desire_to_join = {
		# Base desire for all candidates
		add = { value = 5 }

		# Strong boost for founding city (always wants to be member)
		add = { value = 100 if = { limit = { tag = HSA } } }

		# Coastal countries get a large bonus when the candidate is single-location
		add = { value = 40 if = { limit = { scope:recipient = { num_locations = 1 any_owned_location = { is_coastal = yes } } } } }

		# Economic incentive: simple proxy for merchant activity
		add = { value = 10 if = { limit = { scope:recipient = { total_merchant_capacity > 0 } } } }

		# Proximity: any owned location in core Hansa areas increases desire
		add = { value = 10 if = { limit = { scope:recipient = { any_owned_location = { area ?= area:lower_saxony_area } } } } }

		# Penalty for being already member of an exclusive IO, small negative value
		add = { value = -5 if = { limit = { is_member_of_international_organization = international_organization:hre } } }
	}

	# AI desire to allow new members (existing members' willingness to accept candidates)
	ai_desire_to_allow_new_member = {
		# Base conservatism: members slightly resist new add-ons by default
		add = { value = -5 }

		# Leaders prefer expanding the league moderately
		add = { value = 20 if = { limit = { is_leader_of_international_organization = international_organization:hanseatic_league } } }

		# Members with merchant activity are moderately favorable to new partners
		add = { value = 8 if = { limit = { this = { total_merchant_capacity > 0 } } } }

		# Strategic proximity: members with owned locations in target areas support adding nearby members
		add = { value = 8 if = { limit = { any_owned_location = { area ?= area:lower_saxony_area } } } }

		# Penalty if candidate is large continental power (not desirable)
		add = { value = -20 if = { limit = { scope:recipient = { num_locations > 5 } } } }
	}

	# AI desire for members (existing organization agents considering adding a candidate)
	ai_desire_to_add_member = {
		# Neutral baseline -- leader can push more strongly
		add = { value = 0 }

		# Leaders actively propose growth when they control the IO
		add = { value = 30 if = { limit = { is_leader_of_international_organization = international_organization:hanseatic_league } } }

		# Founding/strong Hansa cities push to expand network
		add = { value = 25 if = { limit = { tag = HSA } } }

		# Candidate attributes - single-location coastal candidates are attractive
		add = { value = 25 if = { limit = { scope:recipient = { num_locations = 1 any_owned_location = { is_coastal = yes } } } } }

		# Trade incentive: simple merchant proxy for members' willingness
		add = { value = 8 if = { limit = { this = { total_merchant_capacity > 0 } } } }

		# Proximity helps: members with holdings in Hansa areas support adding nearby
		add = { value = 10 if = { limit = { any_owned_location = { area ?= area:lower_saxony_area } } } }

		# Penalize adding large continental powers or existing subjects
		add = { value = -30 if = { limit = { scope:recipient = { num_locations > 5 } } } }

		add = { value = -15 if = { limit = { is_subject = yes } } }
	}
}

