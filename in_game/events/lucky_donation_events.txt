namespace = random_event

###################################
# Lucky Donation Event Chain (mod)
###################################

# Event 1001: Initial donation offer
random_event.1001 = {
	type = country_event

	title = random_event.1001.title
	desc = random_event.1001.desc
	

	trigger = {
		# Only between Jan 1, 1400 and Dec 31, 1500
		current_date >= 1400.1.1
		current_date <= 1500.12.31
		# Prefer to trigger in relatively calm times so the donation feels meaningful
		stability >= 0
		at_war = no
		# Only trigger if our treasury is not already overflowing; makes donation meaningful
		gold < 1000
		NOT = { has_country_modifier = received_random_gift_mod }
	}

	option = {
		name = random_event.1001.a
		add_gold = 200
		add_country_modifier = {
			modifier = received_random_gift_mod
			years = 50
		}
		add_country_modifier = {
			modifier = gift_accepted_mod
			years = 10
		}
	}

	option = {
		name = random_event.1001.b
		add_prestige = -10
		add_estate_satisfaction = { type = estate_type:burghers_estate value = -5 }
		add_country_modifier = {
			modifier = received_random_gift_mod
			years = 50
		}
	}

	option = {
		name = random_event.1001.c
		random_neighbor_country = { save_scope_as = target_country }
		if = {
			limit = { exists = scope:target_country }
			add_gold = 150
			add_prestige = 5
		}
		else = {
			add_gold = -50
			add_prestige = -10
			add_estate_satisfaction = { type = estate_type:burghers_estate value = -5 }
		}
		add_country_modifier = {
			modifier = received_random_gift_mod
			years = 50
		}
	}
}

# Event 1002: Follow-up after accepting donation (revisit decision)
random_event.1002 = {
	type = country_event

	title = random_event.1002.title
	desc = random_event.1002.desc

	trigger = {
		# has_country_modifier = gift_accepted_mod
		# Small stability guard so the follow-up doesn't immediately plague a collapsing realm
		stability >= -2
		NOT = { has_country_modifier = donation_followup_decline_shown }
	}

	option = {
		name = random_event.1002.a
		add_prestige = 5
		add_country_modifier = {
			modifier = donation_followup_decline_shown
			years = 50
		}
	}

	option = {
		name = random_event.1002.b
		add_gold = -200
		add_prestige = -10
		add_estate_satisfaction = { type = estate_type:burghers_estate value = -5 }
		add_country_modifier = {
			modifier = donation_followup_decline_shown
			years = 50
		}
	}
}

# Event 1003: Proceed with investigation into donation source
random_event.1003 = {
	type = country_event

	title = random_event.1003.title
	desc = random_event.1003.desc

	trigger = {
		# has_country_modifier = gift_accepted_mod
		# Small stability guard so the follow-up doesn't immediately plague a collapsing realm
		stability >= -2
		NOT = { has_country_modifier = donation_followup_investigate_shown }
	}

	immediate = {
		random_neighbor_country = { 
			save_scope_as = target_country 
		}
	}

	option = {
		name = random_event.1003.a
		if = {
			limit = { scope:target_country ?= { exists = yes } }
			add_prestige = 15
			add_gold = 100
			scope:target_country = { add_prestige = -15 }
		}
		add_country_modifier = {
			modifier = donation_followup_investigate_shown
			years = 50
		}
	}
}

