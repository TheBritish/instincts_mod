namespace = hanseatic_league_events

# Leader proposes candidate to join the Hanseatic League
country_event = {
	id = hanseatic_league_events.1000
    hide_window = yes
    trigger = {
        # event fired by leader targeting candidate
        is_leader_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
		# Candidate evaluates desire to join using their ai_desire_to_join; dispatch vote collector
		# The vote collector will tally member support and call accept/reject paths.
		root = { country_event = { id = hanseatic_league_events.1020 days = 0 target = scope:recipient } }
    }
}

# Vote collector: Heuristic Majority (tallies member support and decides)
country_event = {
	id = hanseatic_league_events.1020
	hide_window = yes
	trigger = {
		is_leader_of_international_organization = international_organization:hanseatic_league
	}
	immediate = {
		# initialize counters on root
		root = {
			set_variable = { name = hl_total_members value = 0 }
			set_variable = { name = hl_yes_votes value = 0 }
			set_variable = { name = hl_temp_double_yes value = 0 }
		}

		# Iterate current members and evaluate willingness to accept the candidate (scope:recipient)
		every_international_organization_member = {
			limit = { NOT = { this = scope:recipient } }
			# increment total members
			root = { change_variable = { name = hl_total_members add = 1 } }

			# Heuristic tests: opinion, cultural affinity, trade interest
			# If any test passes, count as a supportive vote
			if = {
				limit = {
					OR = {
						opinion = { target = scope:recipient value > 10 }
						culture_group = scope:recipient.culture_group
						trade_efficiency > 0
						merchant_capacity > 0
					}
				}
				root = { change_variable = { name = hl_yes_votes add = 1 } }
			}
		}

		# Determine majority: accept if (yes_votes * 2) > total_members
		root = {
			set_variable = { name = hl_temp_double_yes value = var:hl_yes_votes }
			change_variable = { name = hl_temp_double_yes multiply = 2 }
		}

		if = {
			limit = { var:hl_temp_double_yes > var:hl_total_members }
			# majority supports -> add candidate
			root = { country_event = { id = hanseatic_league_events.1001 days = 0 target = scope:recipient } }
		}
		else = {
			# majority rejects -> notify leader and candidate
			root = { country_event = { id = hanseatic_league_events.1002 days = 0 target = scope:recipient } }
		}
	}
}

# Candidate rejected by vote: notify parties and run member reaction flavor
country_event = {
	id = hanseatic_league_events.1002
	hide_window = yes
	trigger = {
		is_leader_of_international_organization = international_organization:hanseatic_league
	}
	immediate = {
		# Notify leader and candidate with hidden member reaction events for flavor
		# Candidate gets a small prestige penalty and notification (handled by engine/localization)
		target = {
			add_prestige = -1
		}

		# Let members react to rejection (flavor)
		every_international_organization_member = {
			limit = { NOT = { this = scope:recipient } }
			country_event = { id = hanseatic_league_events.1100 days = 0 target = scope:recipient }
		}
	}
}

# Candidate accepted: add country to the IO and notify members
country_event = {
	id = hanseatic_league_events.1001
    hide_window = yes
    trigger = {
        # fired on leader (root) with target candidate as scope:recipient
        is_leader_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        # add the candidate to the IO
        add_country_to_international_organization = scope:recipient

        # notify existing members (hidden event) so ai_desire_to_allow_new_member can be applied as flavor
        every_international_organization_member = {
            limit = { NOT = { this = scope:recipient } }
			country_event = { id = hanseatic_league_events.1100 days = 0 target = scope:recipient }
        }
    }
}

# Member reaction (hidden): adjust opinion or trigger effects based on ai_desire_to_allow_new_member
country_event = {
	id = hanseatic_league_events.1100
    hide_window = yes
    trigger = {
        is_member_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        # small opinion modifier toward the new member depending on their attributes
        if = {
            limit = { scope:recipient = { culture_group = culture_group:germanic } }
            add_opinion = { target = scope:recipient modifier = hanseatic_relations_positive }
        }
        else = {
            add_opinion = { target = scope:recipient modifier = hanseatic_relations_neutral }
        }
    }
}

# Trade Dispute Resolution
hanseatic_league_events.1 = {
	type = country_event

	title = hanseatic_league_events.1.title
	desc = hanseatic_league_events.1.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		at_war = no
		any_owned_province = { trade_goods = grain }
		}


	option = {
		name = hanseatic_league_events.1.a
		add_country_modifier = {
			modifier = diplomatic_capacity
			duration = 3650
			}
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = trade_efficiency
				duration = 3650
				value = 0.05
				}
			}
		}

	option = {
		name = hanseatic_league_events.1.b
		add_gold = 50
		random_owned_province = {
			limit = { has_port = yes }
			add_local_unrest = 10
			}
		}
	}

# Pirate Raid on Trade Routes
hanseatic_league_events.2 = {
	type = country_event

	title = hanseatic_league_events.2.title
	desc = hanseatic_league_events.2.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		has_ports = yes
		navy_size > 0
		}


	option = {
		name = hanseatic_league_events.2.a
		add_country_modifier = {
			modifier = naval_morale_bonus
			duration = 3650
			}
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = global_naval_forcelimit_modifier
				duration = 3650
				value = 0.05
				}
			}
		}

	option = {
		name = hanseatic_league_events.2.b
		add_gold = -25
		add_prestige = -5
		}
	}

# New Kontor Established
hanseatic_league_events.3 = {
	type = country_event

	title = hanseatic_league_events.3.title
	desc = hanseatic_league_events.3.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		any_owned_province = { trade_goods = grain }
		}


	option = {
		name = hanseatic_league_events.3.a
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = trade_efficiency
				duration = 3650
				value = 0.03
				}
			}
		}

	option = {
		name = hanseatic_league_events.3.b
		add_prestige = -5
		}
	}

# Merchant Privileges Granted
hanseatic_league_events.4 = {
	type = country_event

	title = hanseatic_league_events.4.title
	desc = hanseatic_league_events.4.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		diplomatic_capacity > 0
		}


	option = {
		name = hanseatic_league_events.4.a
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = diplomatic_reputation
				duration = 3650
				value = 0.05
				}
			}
		}

	option = {
		name = hanseatic_league_events.4.b
		add_country_modifier = {
			modifier = diplomatic_capacity
			duration = 3650
			}
		}
	}

# Internal League Reform
hanseatic_league_events.5 = {
	type = country_event

	title = hanseatic_league_events.5.title
	desc = hanseatic_league_events.5.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		stability > -1
		}


	option = {
		name = hanseatic_league_events.5.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = trade_efficiency
				duration = 3650
				value = 0.04
				}
			}
		add_country_modifier = {
			modifier = stability_cost_reduction
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.5.b
		random_owned_province = {
			add_local_unrest = 5
			}
		}
	}

# External Trade Embargo
hanseatic_league_events.6 = {
	type = country_event

	title = hanseatic_league_events.6.title
	desc = hanseatic_league_events.6.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		any_neighbor_country = { exists = yes }
		}


	option = {
		name = hanseatic_league_events.6.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = trade_efficiency
				duration = 3650
				value = 0.1
				}
			}
		}

	option = {
		name = hanseatic_league_events.6.b
		add_prestige = 5
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}
	}

# Economic Boom Period
hanseatic_league_events.7 = {
	type = country_event

	title = hanseatic_league_events.7.title
	desc = hanseatic_league_events.7.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		any_owned_province = { trade_goods = grain }
		}


	option = {
		name = hanseatic_league_events.7.a
		add_country_modifier = {
			modifier = monthly_gold_income
			duration = 3650
			}
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = trade_efficiency
				duration = 3650
				value = 0.02
				}
			}
		}

	option = {
		name = hanseatic_league_events.7.b
		every_international_organization_member = {
			country_event = { id = hanseatic_league_events.7 }
			}
		}
	}

# Diplomatic Incident
hanseatic_league_events.8 = {
	type = country_event

	title = hanseatic_league_events.8.title
	desc = hanseatic_league_events.8.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		diplomatic_capacity > 0
		}


	option = {
		name = hanseatic_league_events.8.a
		add_prestige = 5
		add_gold = -10
		}

	option = {
		name = hanseatic_league_events.8.b
		add_prestige = -2
		add_gold = 25
		}
	}

# Technological Innovation
hanseatic_league_events.9 = {
	type = country_event

	title = hanseatic_league_events.9.title
	desc = hanseatic_league_events.9.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		has_ports = yes
		}


	option = {
		name = hanseatic_league_events.9.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = naval_morale_modifier
				duration = 3650
				value = 0.1
				}
			}
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.9.b
		add_country_modifier = {
			modifier = naval_maintenance_reduction
			duration = 3650
			}
		}
	}

# Rival League Formation
hanseatic_league_events.10 = {
	type = country_event

	title = hanseatic_league_events.10.title
	desc = hanseatic_league_events.10.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		any_owned_province = { trade_goods = grain }
		}


	option = {
		name = hanseatic_league_events.10.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = global_merchant_capacity_modifier
				duration = 3650
				value = 0.05
				}
			}
		}

	option = {
		name = hanseatic_league_events.10.b
		add_country_modifier = {
			modifier = diplomatic_capacity
			duration = 3650
			}
		random_owned_province = {
			add_local_unrest = 5
			}
		}
	}

# Plague Disruption
hanseatic_league_events.11 = {
	type = country_event

	title = hanseatic_league_events.11.title
	desc = hanseatic_league_events.11.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		any_owned_province = { controlled_by = root }
		}


	option = {
		name = hanseatic_league_events.11.a
		random_owned_province = {
			add_local_unrest = -10
			}
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.11.b
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		add_country_modifier = {
			modifier = global_unrest
			duration = 3650
			}
		}
	}

# New Goods Discovery
hanseatic_league_events.12 = {
	type = country_event

	title = hanseatic_league_events.12.title
	desc = hanseatic_league_events.12.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		has_explorer = yes
		}


	option = {
		name = hanseatic_league_events.12.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = trade_efficiency
				duration = 3650
				value = 0.05
				}
			}
		add_country_modifier = {
			modifier = monthly_gold_income
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.12.b
		add_prestige = 5
		}
	}

# Naval Skirmish
hanseatic_league_events.13 = {
	type = country_event

	title = hanseatic_league_events.13.title
	desc = hanseatic_league_events.13.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		navy_size > 0
		}


	option = {
		name = hanseatic_league_events.13.a
		add_country_modifier = {
			modifier = naval_morale_bonus
			duration = 3650
			}
		add_prestige = 3
		}

	option = {
		name = hanseatic_league_events.13.b
		add_country_modifier = {
			modifier = naval_morale_penalty
			duration = 3650
			}
		add_prestige = -2
		}
	}

# Merchant Guild Expansion
hanseatic_league_events.14 = {
	type = country_event

	title = hanseatic_league_events.14.title
	desc = hanseatic_league_events.14.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		}


	option = {
		name = hanseatic_league_events.14.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = global_burghers_desired_pop
				duration = 3650
				value = 0.02
				}
			}
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.14.b
		random_owned_province = {
			add_local_unrest = 3
			}
		}
	}

# Taxation Dispute
hanseatic_league_events.15 = {
	type = country_event

	title = hanseatic_league_events.15.title
	desc = hanseatic_league_events.15.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		}


	option = {
		name = hanseatic_league_events.15.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = monthly_gold_income
				duration = 3650
				value = 0.2
				}
			}
		}

	option = {
		name = hanseatic_league_events.15.b
		every_international_organization_member = {
			country_event = { id = hanseatic_league_events.15 }
			}
		random_owned_province = {
			add_local_unrest = 5
			}
		}
	}

# Cultural Exchange
hanseatic_league_events.16 = {
	type = country_event

	title = hanseatic_league_events.16.title
	desc = hanseatic_league_events.16.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		stability > 0
		}


	option = {
		name = hanseatic_league_events.16.a
		add_country_modifier = {
			modifier = religious_tolerance_bonus
			duration = 3650
			}
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = diplomatic_reputation
				duration = 3650
				value = 0.03
				}
			}
		}

	option = {
		name = hanseatic_league_events.16.b
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}
	}

# Religious Tensions
hanseatic_league_events.17 = {
	type = country_event

	title = hanseatic_league_events.17.title
	desc = hanseatic_league_events.17.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		any_international_organization_member = { NOT = { religion = root.religion } }
		}


	option = {
		name = hanseatic_league_events.17.a
		add_country_modifier = {
			modifier = religious_tolerance_bonus
			duration = 3650
			}
		add_country_modifier = {
			modifier = stability_cost_reduction
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.17.b
		random_owned_province = {
			add_local_unrest = -5
			}
		add_country_modifier = {
			modifier = religious_tolerance_penalty
			duration = 3650
			}
		}
	}

# Succession Crisis
hanseatic_league_events.18 = {
	type = country_event

	title = hanseatic_league_events.18.title
	desc = hanseatic_league_events.18.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		}


	option = {
		name = hanseatic_league_events.18.a
		add_country_modifier = {
			modifier = diplomatic_capacity
			duration = 3650
			}
		add_prestige = 2
		}

	option = {
		name = hanseatic_league_events.18.b
		random_owned_province = {
			add_local_unrest = 10
			}
		add_prestige = -5
		}
	}

# Exploration Opportunity
hanseatic_league_events.19 = {
	type = country_event

	title = hanseatic_league_events.19.title
	desc = hanseatic_league_events.19.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		has_explorer = yes
		}


	option = {
		name = hanseatic_league_events.19.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = global_merchant_capacity_modifier
				duration = 3650
				value = 0.03
				}
			}
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.19.b
		add_country_modifier = {
			modifier = monthly_gold_income
			duration = 3650
			}
		}
	}

# League Assembly (Tagfahrt)
hanseatic_league_events.20 = {
	type = country_event

	title = hanseatic_league_events.20.title
	desc = hanseatic_league_events.20.desc
	

	trigger = {
		is_member_of_international_organization = international_organization:hanseatic_league
		}


	option = {
		name = hanseatic_league_events.20.a
		international_organization:hanseatic_league = {
			add_international_organization_modifier = {
				modifier = diplomatic_capacity
				duration = 3650
				value = 0.5
				}
			}
		add_country_modifier = {
			modifier = trade_efficiency_bonus
			duration = 3650
			}
		}

	option = {
		name = hanseatic_league_events.20.b
		add_prestige = -2
		}
	}



