namespace = flavor_burgundy

######################################
# BURGUNDY HISTORICAL EVENT CHAIN
# EU5 Compliant Implementation
######################################

# Event 100: The Capetian Extinction (1361)
# The death of Philip of Rouvres splits the Burgundian inheritance
flavor_burgundy.100 = {
	type = country_event
	title = flavor_burgundy.100.t
	desc = flavor_burgundy.100.d
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = c:BUR
		from = 1361.1.1
		to = 1361.12.31
		monthly_chance = 100
	}
	
	trigger = {
		tag = c:BUR
		is_subject_of = c:FRA
		c:FRA = { exists = yes }
		# Only trigger if we own Franche-Comté lands
		any_owned_location = {
			region = franche_comte_region
		}
	}
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
			# Transfer Franche-Comté lands to c:FCB if it exists
			if = {
				limit = { c:FCB = { exists = yes } }
				every_owned_location = {
					limit = { region = franche_comte_region }
					change_location_owner = c:FCB
					add_core = c:FCB
				}
			}
		}
	}
	
	option = {
		name = flavor_burgundy.100.a
		historical_option = yes
		
		custom_tooltip = flavor_burgundy.100.a.tt
		
		# Change from appanage to fiefdom - losing autonomy after succession crisis
		if = {
			limit = { 
				is_subject_of = c:FRA
				c:FRA = { exists = yes }
			}
			c:FRA = {
				make_subject_of = {
					target = root
					type = subject_type:fiefdom
				}
			}
		}
		
		add_stability = -1
		add_prestige = -15
		
		# Trigger the Valois succession event
		trigger_event_silently = {
			id = flavor_burgundy.101
			days = 60
		}
		
		if = {
			limit = { c:FRA = { exists = yes } }
			c:FRA = {
				add_opinion = {
					target = root
					modifier = burgundy_relations_positive
				}
			}
		}
	}
	
	option = {
		name = flavor_burgundy.100.b
		
		add_stability = -2
		add_legitimacy = -20
		
		if = {
			limit = { c:FRA = { exists = yes } }
			c:FRA = {
				add_opinion = {
					target = root
					modifier = burgundy_relations_negative
				}
			}
		}
	}
}

# Event 101: The Valois Appanage (1363)
# King Jean II of France grants Burgundy to his son Philip
flavor_burgundy.101 = {
	type = country_event
	title = flavor_burgundy.101.t
	desc = flavor_burgundy.101.d
	fire_only_once = yes
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
			
			# Create Philip the Bold with the Valois dynasty
			create_character = {
				dynasty = dynasty:valois_dynasty
				culture = root.primary_culture
				religion = root.state_religion
				age = 22
				first_name = name_philip
				adm = { 60 75 }
				dip = { 70 85 }
				mil = { 55 70 }
				add_trait = trait:ambitious
				add_trait = trait:diplomatic
				create_in_limbo = yes
				save_scope_as = philip_the_bold
			}
		}
	}
	
	option = {
		name = flavor_burgundy.101.a
		historical_option = yes
		
		# Move Philip to the Burgundian court first
		scope:philip_the_bold = {
			move_country = root
		}
		
		# Current ruler dies, Philip becomes Duke of Burgundy
		hidden_effect = {
			if = {
				limit = { has_ruler_in_country = yes }
				ruler = {
					kill_character_silently = this
				}
			}
		}
		
		# Philip the Bold becomes the new ruler
		set_new_ruler = scope:philip_the_bold
		
		# Restore appanage status - Burgundy granted to Valois as autonomous duchy
		if = {
			limit = { 
				is_subject_of = c:FRA
				c:FRA = { exists = yes }
			}
			c:FRA = {
				make_subject_of = {
					target = root
					type = subject_type:appanage
				}
			}
		}
		
		add_prestige = 25
		add_legitimacy = 15
		
		# Add loyal appanage modifier from former Event 100
		add_country_modifier = {
			modifier = loyal_appanage
			years = 6
		}
		
		# Set flag for future events
		set_variable = {
			name = valois_dynasty_installed
			value = yes
		}
		
		custom_tooltip = flavor_burgundy.101.a.tt
		
		if = {
			limit = { c:FRA = { exists = yes } }
			c:FRA = {
				add_opinion = {
					target = root
					modifier = burgundy_relations_positive
				}
			}
		}
	}
	
	option = {
		name = flavor_burgundy.101.b
		
		# Reject the Valois heir - keep current dynasty
		add_stability = -1
		add_legitimacy = -10
		
		if = {
			limit = { c:FRA = { exists = yes } }
			c:FRA = {
				add_opinion = {
					target = root
					modifier = burgundy_relations_negative
				}
			}
		}
	}
}



# Event 102: Consolidation of Power (1380-1390)
# Burgundy grows in influence
flavor_burgundy.102 = {
	type = country_event
	title = flavor_burgundy.102.t
	desc = flavor_burgundy.102.d
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = c:BUR
		from = 1380.1.1
		to = 1395.12.31
		monthly_chance = 50
	}
	
	trigger = {
		tag = c:BUR
		any_owned_location = {
			OR = {
				region = brabant_region
				region = flanders_region
				region = holland_region
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
		}
	}
	
	option = {
		name = flavor_burgundy.102.a
		historical_option = yes
		add_country_modifier = {
			modifier = flanders_marriage_alliance
			years = 5
		}
		add_prestige = 20
	}
	
	option = {
		name = flavor_burgundy.102.b
		add_stability = 1
		add_prestige = 10
	}
}

# Event 103: The Golden Age (1400-1430)
# Burgundy reaches its cultural peak
flavor_burgundy.103 = {
	type = country_event
	title = flavor_burgundy.103.t
	desc = flavor_burgundy.103.d
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = c:BUR
		from = 1400.1.1
		to = 1430.12.31
		monthly_chance = 40
	}
	
	trigger = {
		tag = c:BUR
		prestige >= 50
		any_owned_location = {
			development >= 10
		}
	}
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
		}
	}
	
	option = {
		name = flavor_burgundy.103.a
		historical_option = yes
		add_country_modifier = {
			modifier = burgundian_golden_age
			years = 10
		}
		add_prestige = 30
	}
	
	option = {
		name = flavor_burgundy.103.b
		add_stability = 2
		add_prestige = 15
	}
}

# Event 104: The Crisis of Succession (1467)
# Charles the Bold faces decisive battles
flavor_burgundy.104 = {
	type = country_event
	title = flavor_burgundy.104.t
	desc = flavor_burgundy.104.d
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = c:BUR
		from = 1467.1.1
		to = 1477.12.31
		monthly_chance = 50
	}
	
	trigger = {
		tag = c:BUR
		NOT = { is_subject = no }
	}
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
		}
	}
	
	option = {
		name = flavor_burgundy.104.a
		historical_option = yes
		add_country_modifier = {
			modifier = succession_crisis_modifier
			years = 5
		}
		add_prestige = 25
		add_stability = 2
	}
	
	option = {
		name = flavor_burgundy.104.b
		add_prestige = -15
		add_stability = -2
		add_war_exhaustion = 5
	}
}

# Event 105: The Burgundian Circle (1500-1525)
# Burgundy's influence within the Holy Roman Empire
flavor_burgundy.105 = {
	type = country_event
	title = flavor_burgundy.105.t
	desc = flavor_burgundy.105.d
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = c:BUR
		from = 1500.1.1
		to = 1525.12.31
		monthly_chance = 30
	}
	
	trigger = {
		tag = c:BUR
		any_owned_location = {
			OR = {
				region = brabant_region
				region = flanders_region
				region = holland_region
			}
		}
		prestige >= 40
	}
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
		}
	}
	
	option = {
		name = flavor_burgundy.105.a
		historical_option = yes
		add_country_modifier = {
			modifier = burgundy_pragmatic_sanction
			years = 15
		}
		set_government_rank = 1
		add_prestige = 35
	}
	
	option = {
		name = flavor_burgundy.105.b
		add_stability = 2
		add_prestige = 20
	}
}

# Event 106: Religious Tensions (1550-1580)
# The conflict between Spanish rule and Dutch identity
flavor_burgundy.106 = {
	type = country_event
	title = flavor_burgundy.106.t
	desc = flavor_burgundy.106.d
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = c:BUR
		from = 1550.1.1
		to = 1580.12.31
		monthly_chance = 40
	}
	
	trigger = {
		tag = c:BUR
		is_subject_of = c:SPA
		c:SPA = { exists = yes }
		any_owned_location = {
			OR = {
				region = brabant_region
				region = flanders_region
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
			random_neighbor_country = {
				limit = { tag = c:SPA }
				save_scope_as = spain_country
			}
		}
	}
	
	option = {
		name = flavor_burgundy.106.a
		add_country_modifier = {
			modifier = religious_tensions
			years = 10
		}
		add_stability = 1
		if = {
			limit = { c:SPA ?= { exists = yes } }
			c:SPA = {
				add_opinion = {
					target = root
					modifier = burgundy_relations_positive
				}
			}
		}
	}
	
	option = {
		name = flavor_burgundy.106.b
		historical_option = yes
		every_owned_location = {
			limit = {
				OR = {
					region = brabant_region
					region = flanders_region
				}
			}
			add_rebel_progress = 30
		}
		add_stability = -2
		if = {
			limit = { c:SPA = { exists = yes } }
			c:SPA = {
				add_opinion = {
					target = root
					modifier = burgundy_relations_negative
				}
			}
		}
	}
}





