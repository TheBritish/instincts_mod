namespace = flavor_burgundy

######################################
# PROLOGUE EVENT CHAIN (1361-1369)
# Capetian to Valois Transition
######################################

	# Prologue Event 1: Death of John II - Valois Inheritance (1363)
	flavor_burgundy.100 = {
		type = country_event
		title = flavor_burgundy.100.t
		desc = flavor_burgundy.100.d
		fire_only_once = yes

	trigger = {
		tag = BUR
		current_date >= 1363.1.1
	}

	immediate = {
		hidden_effect = {
			save_scope_as = burgundy_country
			# Kill the current ruler (John II dies historically)
			if = {
				limit = { has_ruler = yes }
				kill_character = scope:root.GetRuler
			}
		}
	}	option = {
		name = flavor_burgundy.100.a
		ai_chance = { factor = 75 }

		# The duchy legally reverts to France
		custom_tooltip = {
			text = flavor_burgundy.100.a.tooltip
		}

		# Trigger next event for player who takes France
		trigger_event = { id = flavor_burgundy.101 days = 1 }
	}

	option = {
		name = flavor_burgundy.100.b
		ai_chance = { factor = 25 }

		# Reject French overlordship - triggers follow-up
		trigger_event = { id = flavor_burgundy.103 days = 5 }
	}
}

# Prologue Follow-up to Event 1 Option B: Rebellion and Reconquest
flavor_burgundy.103 = {
	type = country_event
	title = flavor_burgundy.103.t
	desc = flavor_burgundy.103.d
	fire_only_once = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = { c:FRA = { exists = yes } }
				c:FRA = {
					add_casus_belli = {
						target = root
						type = casus_belli:cb_fabricated_conquer_province
					}
				}
			}
		}
	}

	option = {
		name = flavor_burgundy.103.a

		add_opinion = { target = c:FRA modifier = opinion_insulted }

		# War taxes due to crisis
		add_country_modifier = { 
			modifier = succession_crisis_modifier 
			duration = 1095 
		}
	}
}

# Prologue Event 2: The Gift of King Jean - Valois Dynasty Granted
flavor_burgundy.101 = {
	type = country_event
	title = flavor_burgundy.101.t
	desc = flavor_burgundy.101.d
	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = flavor_burgundy.101.a

		# Create the Valois dynasty for Burgundy
		create_named_dynasty = valois_dynasty

		# Create Philip the Bold as the first Valois Duke of Burgundy
		create_character = {
			first_name = name_philip
			dynasty = dynasty:valois_dynasty
			age = 35
			culture = burgundian
			religion = catholic
			adm = 70
			dip = 75
			mil = 65
			birth_location = capital_scope
			traits = {
				ambitious
				diplomatic
				shrewd
			}
			save_scope_as = philip_the_bold
		}

		# Make Philip the Bold the ruler of Burgundy
		set_character_as_ruler = scope:philip_the_bold

		# Grant loyalty modifier as French appanage
		add_country_modifier = {
			modifier = loyal_appanage
			duration = 2190
		}

		# Improve relations with overlord
		add_opinion = { target = c:FRA modifier = opinion_allied }
	}
}

# Prologue Event 3: The Wedding in Ghent (1369) - Securing Flanders Alliance
flavor_burgundy.102 = {
	type = country_event
	title = flavor_burgundy.102.t
	desc = flavor_burgundy.102.d
	fire_only_once = yes

	trigger = {
		tag = BUR
		current_date >= 1369.1.1
	}

	option = {
		name = flavor_burgundy.102.a

		# Historically, Philip the Bold gained control of Flanders through marriage
		if = {
			limit = { c:FLA = { exists = yes } }
			# Add opinion before absorbing Flanders
			add_opinion = { target = c:FLA modifier = opinion_allied }
			# Absorb Flanders into Burgundy
			c:FLA = {
				every_owned_location = {
					change_location_owner = root
				}
			}
			# Administrative reward representing Flanders integration
			add_country_modifier = {
				modifier = flanders_marriage_alliance
				duration = 1825
			}
		}
	}
}

######################################
# MAIN EVENT CHAIN (1380-1550)
# Burgundy's Golden Age to Spanish Split
######################################

# Phase I - The Golden Age (1380+)
flavor_burgundy.1 = {
	type = country_event
	title = flavor_burgundy.1.t
	desc = flavor_burgundy.1.d
	fire_only_once = yes

	trigger = {
		tag = BUR
		current_date >= 1380.1.1
		OR = {
			any_owned_location = { region = region:low_countries_region }
			any_subject_country = { any_owned_location = { region = region:low_countries_region } }
		}
	}

	option = {
		name = flavor_burgundy.1.a
		add_country_modifier = { modifier = middle_kingdom_diplomacy duration = 5475 }

		if = {
			limit = { c:FRA = { exists = yes } }
			add_opinion = { target = c:FRA modifier = opinion_allied }
		}
	}
}

# Phase I follow-up - Connecting the Lands (1460+)
flavor_burgundy.2 = {
	type = country_event
	title = flavor_burgundy.2.t
	desc = flavor_burgundy.2.d
	fire_only_once = yes

	trigger = {
		tag = BUR
		current_date >= 1460.1.1
	}

	option = {
		name = flavor_burgundy.2.a

		# Burgundy claims Lorraine as the bridge between Low Countries and Rhineland
		if = {
			limit = { c:LOR = { exists = yes } }
			add_casus_belli = {
				target = c:LOR
				type = casus_belli:cb_conquest
			}
		}

		# Add core claims to Lorraine territories
		every_location = {
			limit = { region = region:lorraine_region }
			add_core = root
		}

		add_country_modifier = { modifier = burgundy_war_taxes duration = 1095 }
	}
}

	# Phase II - The Catastrophe of 1477
	flavor_burgundy.10 = {
		type = country_event
		title = flavor_burgundy.10.t
		desc = flavor_burgundy.10.d
		fire_only_once = yes

		trigger = {
			tag = BUR
			current_date >= 1477.1.1
			is_subject = no
			any_owned_location = { region = region:low_countries_region }
		}

		option = {
			name = flavor_burgundy.10.a
			
			# Transfer only French territories back to France
			if = {
				limit = { c:FRA = { exists = yes } }
				every_location = {
					limit = { region = region:france_region }
					change_location_owner = c:FRA
				}
			}
			
			# Burgundy keeps Low Countries and core lands but enters personal union under Austria
			add_country_modifier = { modifier = imperial_protection duration = 1095 }

			if = {
				limit = { c:AUS = { exists = yes } }
				add_opinion = { target = c:AUS modifier = opinion_allied }
				# Burgundy enters personal union under Austria (keeps its remaining lands)
				create_personal_union = {
					subject = root
					overlord = c:AUS
				}
			}
		}

		option = {
			name = flavor_burgundy.10.b
			
			# Transfer only French territories back to France
			if = {
				limit = { c:FRA = { exists = yes } }
				every_location = {
					limit = { region = region:france_region }
					change_location_owner = c:FRA
				}
			}
			
			# Burgundy keeps all remaining lands (Low Countries, Burgundy, Rhine)
			add_opinion = { target = c:FRA modifier = opinion_insulted }

			if = {
				limit = { c:AUS = { exists = yes } }
				add_opinion = { target = c:AUS modifier = opinion_insulted }
			}
		}
}

	# Phase III - The Burgundian Circle (1521+)
	flavor_burgundy.20 = {
		type = country_event
		title = flavor_burgundy.20.t
		desc = flavor_burgundy.20.d
		fire_only_once = yes

		trigger = {
			tag = BUR
			current_date >= 1521.1.1
		any_owned_location = { region = region:low_countries_region }
	}

	option = {
		name = flavor_burgundy.20.a
		add_country_modifier = { modifier = burgundy_pragmatic_sanction duration = 10950 }
		# Apply province modifiers to Low Countries
		every_location = {
			limit = { region = region:low_countries_region }
			add_location_modifier = { modifier = burgundian_circle duration = 10950 }
		}
	}
}

	# Phase IV - The Spanish Split / Dutch Revolt (1568+)
	flavor_burgundy.30 = {
		type = country_event
		title = flavor_burgundy.30.t
		desc = flavor_burgundy.30.d
		fire_only_once = yes

		trigger = {
			tag = BUR
			current_date >= 1568.1.1
			any_owned_location = { region = region:low_countries_region }
			is_subject_of = c:SPA
		}

		option = {
		name = flavor_burgundy.30.a

		if = {
			limit = { c:SPA = { exists = yes } }
			add_opinion = { target = c:SPA modifier = opinion_allied }
		}

		# Set flag for future Dutch Revolt events
		set_country_flag = dutch_revolt_brewing
	}
}
