namespace = hanseatic_league_events

# Leader proposes candidate to join the Hanseatic League
hanseatic_league_events.1000 = {
    type = country_event
    title = hanseatic_league_events.1000.title
    desc = hanseatic_league_events.1000.desc
    option = { name = hanseatic_league_events.1000.a }
    trigger = {
        is_leader_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        # dispatch vote collector on the leader (target candidate preserved)
        root = { trigger_event = { id = hanseatic_league_events.1020 days = 0 target = scope:target } }
    }
}

# Vote collector: Heuristic Majority (tallies member support and decides)
hanseatic_league_events.1020 = {
    type = country_event
    title = hanseatic_league_events.1020.title
    desc = hanseatic_league_events.1020.desc
    option = { name = hanseatic_league_events.1020.a }
    trigger = {
        is_leader_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        set_variable = { name = hl_total_members value = 0 }
        set_variable = { name = hl_yes_votes value = 0 }

        every_international_organization_member = {
            limit = { NOT = { this = scope:target } }
            this = {
                root = { change_variable = { name = hl_total_members add = 1 } }
                if = {
                    limit = {
                        OR = {
                            opinion = { target = scope:target value > 10 }
                            this = { trade_efficiency > 0 }
                            this = { total_merchant_capacity > 0 }
                        }
                    }
                    root = { change_variable = { name = hl_yes_votes add = 1 } }
                }
            }
        }

        # Determine majority
        set_variable = { name = hl_temp_double_yes value = var:hl_yes_votes }
        change_variable = { name = hl_temp_double_yes multiply = 2 }

        if = {
            limit = { var:hl_temp_double_yes > var:hl_total_members }
            root = { trigger_event = { id = hanseatic_league_events.1001 days = 0 target = scope:target } }
        }
        else = {
            root = { trigger_event = { id = hanseatic_league_events.1002 days = 0 target = scope:target } }
        }
    }
}

# Candidate rejected by vote: notify parties and run member reaction flavor
hanseatic_league_events.1002 = {
    type = country_event
    title = hanseatic_league_events.1002.title
    desc = hanseatic_league_events.1002.desc
    option = { name = hanseatic_league_events.1002.a }
    trigger = {
        is_leader_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        target = { add_prestige = -1 }
        every_international_organization_member = {
            limit = { NOT = { this = scope:target } }
            this = { trigger_event = { id = hanseatic_league_events.1100 days = 0 target = scope:target } }
        }
    }
}

# Candidate accepted: add country to the IO and notify members
hanseatic_league_events.1001 = {
    type = country_event
    title = hanseatic_league_events.1001.title
    desc = hanseatic_league_events.1001.desc
    option = { name = hanseatic_league_events.1001.a }
    trigger = {
        is_leader_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        add_country_to_international_organization = scope:target
        every_international_organization_member = {
            limit = { NOT = { this = scope:target } }
            this = { trigger_event = { id = hanseatic_league_events.1100 days = 0 target = scope:target } }
        }
    }
}

# Member reaction (hidden): adjust opinion or trigger effects based on ai_desire_to_allow_new_member
hanseatic_league_events.1100 = {
    type = country_event
    title = hanseatic_league_events.1100.title
    desc = hanseatic_league_events.1100.desc
    option = { name = hanseatic_league_events.1100.a }
    trigger = {
        is_member_of_international_organization = international_organization:hanseatic_league
    }
    immediate = {
        if = {
            limit = { scope:target = { culture_group = culture_group:germanic } }
            add_opinion = { target = scope:target modifier = hanseatic_relations_positive }
        }
        else = { add_opinion = { target = scope:target modifier = hanseatic_relations_neutral } }
    }
}
